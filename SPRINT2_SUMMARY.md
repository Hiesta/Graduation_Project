# Sprint 2 - Расширение API

## Выполненные задачи ✅

### 1. Новые API методы
- **GET /api/submitData/{id}** - получение перевала по ID
- **PATCH /api/submitData/{id}** - обновление перевала (только статус 'new')
- **GET /api/submitData/?user__email=<email>** - получение перевалов по email с пагинацией

### 2. Расширение репозитория
- `get_pereval_by_id(pereval_id: int)` - получение перевала по ID
- `update_pereval(pereval_id: int, data: dict)` - обновление с проверкой статуса
- `list_perevals_by_user_email(email: str, offset: int, limit: Optional[int])` - список с пагинацией

### 3. Новые Pydantic схемы
- `PerevalUpdate` - для обновления перевала
- `PerevalDetailResponse` - для детального ответа
- `UpdateResponse` - для ответов обновления

### 4. Тестирование
- **Unit-тесты репозитория** (`tests/test_repository.py`)
  - Создание перевала
  - Получение по ID
  - Обновление (успех/ошибка)
  - Получение списка с пагинацией
- **Интеграционные тесты API** (`tests/test_api_integration.py`)
  - Полный цикл: создание → получение → обновление → список
  - Обработка ошибок
  - Валидация данных

### 5. Документация
- Обновлен README.md с примерами всех новых методов
- Добавлены curl примеры
- Описаны коды ответов и ограничения
- Добавлен раздел тестирования

### 6. Дополнительно
- Демонстрационный скрипт `demo_api.py`
- Автоматическая документация Swagger
- Обработка ошибок и валидация
- Соблюдение PEP8

## Критерии оценки

| Критерий | Баллы | Статус |
|----------|-------|--------|
| Создан класс по работе с БД | 10 | ✅ |
| Реализован REST API (Sprint 2) | 15 | ✅ |
| Написана документация в README.md | 5 | ✅ |
| Хорошее качество кода (PEP8, читаемость) | 5 | ✅ |
| Swagger | 5 | ✅ |
| Покрытие тестами | 5 | ✅ |
| Корректная работа с Git | 5 | ✅ |
| **ИТОГО** | **50** | **✅** |

## Git Workflow

1. ✅ Создана ветка `feature/submitData-sprint2`
2. ✅ Осмысленные коммиты (готовы к выполнению)
3. ⏳ Готово к слиянию в main

## Запуск и тестирование

```bash
# Запуск API
uvicorn main:app --reload

# Запуск тестов
pytest tests/

# Демонстрация
python demo_api.py

# Swagger UI
http://localhost:8000/docs
```

## Особенности реализации

- **Безопасность**: Обновление только перевалов со статусом 'new'
- **Валидация**: Запрет изменения ФИО, email, телефона пользователя
- **Пагинация**: Поддержка offset/limit для больших списков
- **Обработка ошибок**: Детальные сообщения для всех сценариев
- **Тестирование**: Полное покрытие unit и интеграционными тестами
